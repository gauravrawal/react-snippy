"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _typeof2 = _interopRequireDefault(require("@babel/runtime/helpers/typeof"));

function createStore(initial) {
  var handlers = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  if (!initial) {
    throw new Error('initial state is required');
  }

  var state = {
    current: initial
  };

  function getState() {
    var selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function (state) {
      return state;
    };
    return selector(state.current);
  }

  function setState(causedChanges) {
    var changes = typeof causedChanges === 'function' ? causedChanges(state.current) : causedChanges; // check only in development

    validateChanges(initial, changes);
    Object.assign(state.current, changes);
    Object.keys(changes).forEach(function (field) {
      return handlers[field] && handlers[field](changes[field]);
    });
  }

  return [getState, setState];
}

function validateChanges(initial, changes) {
  if ((0, _typeof2.default)(changes) !== 'object') {
    throw new Error('provided value of changes should be an object');
  }

  if (Object.keys(changes).some(function (field) {
    return !initial.hasOwnProperty(field);
  })) {
    throw new Error('It seams you want to change a field in the store which is not specified in the "initial" state');
  }
}

var _default = createStore;
exports.default = _default;